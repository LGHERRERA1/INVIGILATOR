<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invigilator Case - Consolidated Financial Statement</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .animate-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gray-200">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- Icons ---
        const XIcon = ({size=24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const InfoIcon = ({size=24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const MenuIcon = ({size=24}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>;
        const ListIcon = ({size=18}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>;
        const ArrowRight = ({size=16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>;

        const FinancialStatementInteractive = () => {
            const [selectedCell, setSelectedCell] = useState(null);
            const [isMenuOpen, setIsMenuOpen] = useState(false);
            const [activeTab, setActiveTab] = useState('overview');

            // --- MENU STRUCTURE (Updated Order) ---
            const menuTabs = [
                { id: 'overview', label: 'Overview', icon: ListIcon },
                { id: 'step1', label: '1. Fair Value', num: '1' }, // Was Step 2
                { id: 'step2', label: '2. Aggregation', num: '2' }, // Was Step 1
                { id: 'step3', label: '3. Elim. Invest.', num: '3' },
                { id: 'step4', label: '4. Goodwill & NCI', num: '4' },
                { id: 'step5', label: '5. Intra-group', num: '5' },
            ];

            // --- DATA ---
            const data = [
                { type: 'section', label: 'ASSETS' },
                { 
                    type: 'row', label: 'Intangible assets', c1: '-', c2: '2,000', c3: '82,000', c4: '82,000', 
                    explanation: { 
                        title: 'Intangible Assets Calculation', 
                        theory: 'Under IFRS 3, the acquirer must recognize all identifiable assets of the acquiree at their acquisition-date fair values, even if they were not previously recognized in the acquiree\'s financial statements.',
                        math: '0 + 82,000 = 82,000', 
                        details: 'Recognizing a Lemma patent (Fair Value 80,000) added to its book value (2,000).' 
                    } 
                },
                { 
                    type: 'row', label: 'Goodwill', c1: '-', c2: '-', c3: '-', c4: '222,000', 
                    explanation: { 
                        title: 'Detailed Goodwill Calculation',
                        isRichContent: true,
                        theory: 'Goodwill represents the future economic benefits arising from assets that are not capable of being individually identified and separately recognized. It essentially captures the premium paid over the fair market value of the net assets acquired.',
                        steps: [
                            { label: 'A. Price Paid', value: '600,000', desc: 'Total investment cost', color: 'blue' },
                            { label: 'B. Acquired Value', value: '378,000', desc: '90% of Net Assets (420,000)', color: 'green', operator: '-' },
                            { label: 'C. Goodwill', value: '222,000', desc: 'Premium paid', color: 'teal', operator: '=', isResult: true }
                        ]
                    } 
                },
                { type: 'row', label: 'Property, plant & equipment', c1: '490,000', c2: '80,000', c3: '160,000', c4: '650,000', explanation: { title: 'Property, Plant & Equipment', math: '490,000 + 160,000 = 650,000', details: 'Lemma\'s fair value (160,000) is taken instead of book value (80,000).' } },
                { 
                    type: 'row', label: 'Investment in Lemma', c1: '600,000', c2: '-', c3: '-', c4: '-', 
                    explanation: { 
                        title: 'Investment Elimination', 
                        theory: 'In consolidated statements, the parent and subsidiary are viewed as a single entity. You cannot hold an investment in yourself. Therefore, the "Investment" asset is eliminated against the Subsidiary\'s Equity.',
                        math: '600,000 - 600,000 = 0', 
                        details: 'Investment is eliminated against the subsidiary\'s equity.' 
                    } 
                },
                { type: 'row', label: 'Inventories', c1: '230,000', c2: '360,000', c3: '320,000', c4: '550,000', explanation: { title: 'Inventories', math: '230,000 + 320,000 = 550,000', details: 'Lemma\'s inventory was adjusted downwards (from 360,000 to 320,000) to fair value.' } },
                { type: 'row', label: 'Trade and other receivables', c1: '400,000', c2: '240,000', c3: '240,000', c4: '540,000', explanation: { title: 'Trade Receivables', math: '(400,000 + 240,000) - 100,000', details: 'Elimination of intra-group debt of 100,000.' } },
                
                { type: 'grand_total', label: 'TOTAL ASSETS', c1: '1,720,000', c2: '682,000', c3: '802,000', c4: '2,044,000', isTotal: true },
                
                { type: 'spacer' },
                { type: 'section', label: 'EQUITY' },
                { 
                    type: 'row', label: 'Share capital', c1: '1,000,000', c2: '200,000', c3: '-', c4: '1,000,000', 
                    explanation: { 
                        title: 'Share Capital', 
                        theory: 'Consolidated equity reflects the equity of the parent company only. The subsidiary\'s pre-acquisition equity is eliminated because it has been effectively replaced by the specific assets and liabilities acquired.',
                        math: 'Parent Only', 
                        details: 'Only Invigilator\'s capital is shown.' 
                    } 
                },
                { type: 'row', label: 'Reserves', c1: '140,000', c2: '100,000', c3: '-', c4: '140,000', explanation: { title: 'Reserves', math: 'Parent Only', details: 'Lemma\'s pre-acquisition reserves are eliminated.' } },
                { 
                    type: 'row', label: 'Non-controlling interest', c1: '-', c2: '-', c3: '-', c4: '42,000', 
                    explanation: { 
                        title: 'NCI (Non-Controlling Interest)', 
                        isRichContent: true,
                        theory: 'NCI represents the 10% of Lemma that Invigilator does not own. While we consolidate 100% of assets/liabilities, we use this equity account to acknowledge the external shareholders\' stake.',
                        steps: [
                            { label: 'Real Net Assets', value: '420,000', desc: 'Equity adjusted to Fair Value', color: 'slate' },
                            { label: 'Minority %', value: '10%', desc: 'Portion NOT owned by Invigilator', color: 'teal', operator: '×' },
                            { label: 'NCI', value: '42,000', desc: 'Consolidated book value', color: 'teal', operator: '=', isResult: true }
                        ]
                    } 
                },
                { type: 'total', label: 'TOTAL EQUITY', c1: '1,140,000', c2: '300,000', c3: '420,000', c4: '1,182,000', isTotal: true },
                { type: 'spacer' },
                { type: 'section', label: 'LIABILITIES' },
                { type: 'row', label: 'Provisions', c1: '20,000', c2: '30,000', c3: '30,000', c4: '50,000' },
                { type: 'row', label: 'Current liabilities', c1: '560,000', c2: '352,000', c3: '352,000', c4: '812,000', explanation: { title: 'Current Liabilities', math: '(560,000 + 352,000) - 100,000', details: 'Elimination of intra-group debt.' } },
                { type: 'total', label: 'TOTAL LIABILITIES', c1: '580,000', c2: '382,000', c3: '382,000', c4: '862,000', isTotal: true },
                { type: 'spacer' },
                { type: 'grand_total', label: 'TOTAL EQUITY & LIABILITIES', c1: '1,720,000', c2: '682,000', c3: '802,000', c4: '2,044,000', isTotal: true },
            ];

            const handleCellClick = (row) => { if (row.explanation) setSelectedCell(row); };

            const renderTabContent = () => {
                switch (activeTab) {
                    case 'overview':
                        return (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">Consolidation Logic Overview</h3>
                                <p className="text-sm text-slate-600 mb-4">Click on the numbered tabs above to see the details of each step.</p>
                                <div className="space-y-2">
                                    {['1. Fair Value Adjustments', '2. Aggregation of Financial Statements', '3. Eliminate Investment vs. Equity', '4. Recognize Goodwill & NCI', '5. Eliminate Intra-group Items'].map((step, i) => (
                                        <div key={i} onClick={() => setActiveTab(`step${i+1}`)} className="bg-white p-3 rounded-lg shadow-sm border-l-4 border-teal-500 cursor-pointer hover:bg-teal-50 transition-colors flex justify-between items-center group">
                                            <span className="font-bold text-teal-800 text-sm">{step}</span>
                                            <ArrowRight className="text-slate-300 group-hover:text-teal-600" />
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );
                    case 'step1': // WAS STEP 2 (FAIR VALUE)
                        return (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">1. Fair Value Adjustments</h3>
                                <p className="text-sm text-slate-700 bg-blue-50 p-3 rounded border border-blue-100">
                                    <strong>Logical Order:</strong> Before mixing the accounts, we must first adjust the Subsidiary's book values to their Fair Values at the date of acquisition.
                                </p>
                                <div className="space-y-3">
                                    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                        <div className="flex justify-between items-center mb-2"><span className="font-bold text-slate-700">1. Patents</span><span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">+80,000</span></div>
                                        <div className="text-sm text-slate-500 font-mono">Book: 2,000 <span className="inline-block mx-1">→</span> FV: 82,000</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                        <div className="flex justify-between items-center mb-2"><span className="font-bold text-slate-700">2. Prop, Plant & Eq.</span><span className="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">+80,000</span></div>
                                        <div className="text-sm text-slate-500 font-mono">Book: 80,000 <span className="inline-block mx-1">→</span> FV: 160,000</div>
                                    </div>
                                    <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                        <div className="flex justify-between items-center mb-2"><span className="font-bold text-slate-700">3. Inventories</span><span className="bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full">-40,000</span></div>
                                        <div className="text-sm text-slate-500 font-mono">Book: 360,000 <span className="inline-block mx-1">→</span> FV: 320,000</div>
                                    </div>
                                    <div className="bg-blue-50 p-3 rounded border border-blue-200 mt-4"><p className="font-bold text-blue-900 text-sm">Net Impact on Assets:</p><p className="font-mono text-lg text-blue-700">+120,000</p></div>
                                </div>
                            </div>
                        );
                    case 'step2': // WAS STEP 1 (AGGREGATION)
                        return (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">2. Aggregation</h3>
                                <p className="text-sm text-slate-700 bg-gray-50 p-3 rounded border border-gray-200">
                                    <strong>Concept:</strong> Once adjusted, we combine the financial statements of the Parent and Subsidiary line by line (100% + 100%).
                                </p>
                                <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                    <h4 className="font-bold text-sm text-slate-800 mb-2">Example: Current Liabilities</h4>
                                    <div className="flex justify-between items-center text-sm font-mono text-slate-600">
                                        <span>Invigilator</span> <span>560,000</span>
                                    </div>
                                    <div className="flex justify-between items-center text-sm font-mono text-slate-600 border-b border-slate-300 pb-1 mb-1">
                                        <span>+ Lemma</span> <span>352,000</span>
                                    </div>
                                    <div className="flex justify-between items-center font-bold text-slate-800">
                                        <span>= Combined</span> <span>912,000</span>
                                    </div>
                                    <p className="text-xs text-slate-400 mt-2 italic">(Before eliminations)</p>
                                </div>
                            </div>
                        );
                    case 'step3':
                        return (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">3. Eliminate Investment vs. Equity</h3>
                                <p className="text-sm text-slate-700 bg-red-50 p-3 rounded border border-red-100">
                                    <strong>Goal:</strong> Avoid double counting. The "Investment" asset (600k) represents the value of Lemma's Equity. We cannot show both.
                                </p>
                                
                                <div className="space-y-2">
                                    <div className="bg-white p-3 rounded border-l-4 border-red-500">
                                        <p className="text-xs uppercase font-bold text-red-400">Eliminate Asset</p>
                                        <div className="flex justify-between font-mono text-slate-700"><span>Invigilator Investment</span> <span>-600,000</span></div>
                                    </div>
                                    <div className="bg-white p-3 rounded border-l-4 border-red-500">
                                        <p className="text-xs uppercase font-bold text-red-400">Eliminate Subsidiary Equity</p>
                                        <div className="flex justify-between font-mono text-slate-700 text-sm"><span>Lemma Share Capital</span> <span>-200,000</span></div>
                                        <div className="flex justify-between font-mono text-slate-700 text-sm"><span>Lemma Reserves</span> <span>-100,000</span></div>
                                    </div>
                                </div>
                                <p className="text-xs text-center text-slate-500 mt-2">The difference between these amounts helps calculate Goodwill in Step 4.</p>
                            </div>
                        );
                    case 'step4':
                        return (
                            <div className="space-y-6 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">4. Recognize Goodwill & NCI</h3>
                                
                                {/* Goodwill Section */}
                                <div>
                                    <h4 className="text-sm font-bold text-teal-600 uppercase tracking-widest mb-2 border-b border-teal-200 pb-1">Part A: Goodwill</h4>
                                    <div className="space-y-2">
                                        <div className="bg-white p-3 rounded shadow-sm border-l-4 border-blue-500 flex justify-between"><div><p className="text-xs text-slate-500 uppercase font-bold">Price Paid</p></div><div className="text-sm font-mono font-bold text-slate-800">600,000</div></div>
                                        <div className="bg-white p-3 rounded shadow-sm border-l-4 border-green-500 flex justify-between"><div><p className="text-xs text-slate-500 uppercase font-bold">Acquired Value</p><p className="text-[10px] text-slate-500">90% of (300k Equity + 120k FV Adj)</p></div><div className="text-sm font-mono font-bold text-slate-800">-378,000</div></div>
                                        <div className="bg-slate-900 text-white p-2 rounded text-center"><p className="text-xs uppercase font-bold">Goodwill = 222,000</p></div>
                                    </div>
                                </div>

                                {/* NCI Section */}
                                <div>
                                    <h4 className="text-sm font-bold text-purple-600 uppercase tracking-widest mb-2 border-b border-purple-200 pb-1">Part B: NCI</h4>
                                    <div className="bg-purple-50 p-3 rounded border border-purple-200 text-center">
                                        <p className="text-xs text-purple-800 mb-1 font-bold">10% Minority Stake on Adjusted Net Assets</p>
                                        <div className="font-mono text-lg text-slate-800">
                                            420,000 <span className="text-purple-500">×</span> 10% = <span className="font-bold text-purple-700">42,000</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        );
                    case 'step5':
                        return (
                            <div className="space-y-4 animate-in">
                                <h3 className="text-xl font-bold text-teal-800 flex items-center gap-2">5. Eliminate Intra-group</h3>
                                <p className="text-sm text-slate-700 bg-yellow-50 p-3 rounded border border-yellow-100">
                                    <strong>Concept:</strong> A consolidated entity cannot owe money to itself. We must remove any internal debts to show only what is owed to/from external parties.
                                </p>
                                <div className="bg-white p-4 rounded-lg shadow-sm border border-slate-200">
                                    <h4 className="font-bold text-sm text-slate-800 mb-2">Scenario:</h4>
                                    <p className="text-sm text-slate-600 mb-4">Invigilator owes Lemma <span className="font-mono font-bold">100,000</span> for services.</p>
                                    
                                    <div className="flex items-center gap-4">
                                        <div className="flex-1 bg-red-50 p-2 rounded text-center border border-red-100">
                                            <p className="text-xs font-bold text-red-700 uppercase">Assets</p>
                                            <p className="text-xs text-slate-500">Receivables</p>
                                            <p className="font-mono font-bold text-red-600">-100,000</p>
                                        </div>
                                        <div className="text-slate-400">↔</div>
                                        <div className="flex-1 bg-red-50 p-2 rounded text-center border border-red-100">
                                            <p className="text-xs font-bold text-red-700 uppercase">Liabilities</p>
                                            <p className="text-xs text-slate-500">Payables</p>
                                            <p className="font-mono font-bold text-red-600">-100,000</p>
                                        </div>
                                    </div>
                                    <p className="text-xs text-center text-slate-400 mt-2">Net impact on Equity = 0</p>
                                </div>
                            </div>
                        );
                    default: return null;
                }
            };

            return (
                <div className="min-h-screen bg-gray-200 p-4 md:p-8 font-sans flex justify-center items-start relative overflow-hidden">
                
                {/* Sidebar Menu */}
                {isMenuOpen && (
                    <div className="fixed inset-0 z-40 flex">
                        <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setIsMenuOpen(false)}></div>
                        <div className="relative h-full w-full md:w-[450px] bg-white shadow-2xl z-50 flex flex-col animate-in slide-in-from-left duration-300">
                            <div className="bg-slate-900 text-white p-6 flex justify-between items-center"><h2 className="text-2xl font-bold">Educational Menu</h2><button onClick={() => setIsMenuOpen(false)}><XIcon size={24} /></button></div>
                            
                            {/* MENU TABS GRID */}
                            <div className="grid grid-cols-3 gap-1 p-2 border-b border-gray-200 bg-gray-50">
                                {menuTabs.map(tab => (
                                    <button 
                                        key={tab.id} 
                                        onClick={() => setActiveTab(tab.id)} 
                                        className={`flex flex-col items-center justify-center p-2 rounded transition-colors border text-center h-20
                                            ${activeTab === tab.id 
                                                ? 'bg-white border-teal-500 text-teal-700 shadow-sm ring-1 ring-teal-500' 
                                                : 'bg-white border-gray-200 text-slate-500 hover:bg-gray-100 hover:text-slate-700'}`}
                                    >
                                        {tab.icon ? <tab.icon size={20} className="mb-1" /> : <span className="text-lg font-black opacity-80 mb-1">{tab.num}</span>}
                                        <span className="text-[10px] font-bold uppercase tracking-tight leading-tight">{tab.label}</span>
                                    </button>
                                ))}
                            </div>

                            <div className="flex-1 overflow-y-auto p-6 bg-gray-50/50">{renderTabContent()}</div>
                            <div className="p-4 border-t border-gray-200 bg-white text-center"><button onClick={() => setIsMenuOpen(false)} className="w-full bg-slate-800 text-white py-3 rounded-lg font-bold hover:bg-slate-700 transition">Back to Table</button></div>
                        </div>
                    </div>
                )}

                {/* Main Table Container */}
                <div className="w-full max-w-4xl bg-white shadow-xl border border-gray-300 transition-all duration-300">
                    <div className="bg-slate-900 text-white px-8 py-6 border-b-4 border-teal-500 flex justify-between items-center sticky top-0 z-10">
                        <div className="flex items-center gap-4">
                            <button onClick={() => setIsMenuOpen(true)} className="bg-teal-600 hover:bg-teal-500 text-white p-2 md:px-4 md:py-2 rounded-lg font-bold shadow-lg flex items-center gap-2 transition-all transform hover:scale-105"><MenuIcon size={20} /><span className="hidden md:inline">Educational Menu</span></button>
                            <div><h1 className="text-xl md:text-3xl font-extrabold uppercase">INVIGILATOR CASE</h1><p className="text-teal-400 text-xs md:text-sm font-semibold">Interactive Consolidated</p></div>
                        </div>
                    </div>
                    <div className="overflow-x-auto">
                        <table className="w-full text-left border-collapse">
                            <thead>
                                <tr className="bg-slate-100 text-slate-800">
                                    <th className="py-3 pl-4 pr-2 text-sm md:text-base font-bold uppercase tracking-tight border-b-2 border-slate-800 border-r border-slate-300 w-1/3">Account / Item</th>
                                    <th className="py-3 px-2 text-right text-sm md:text-base font-bold border-b-2 border-slate-800 border-r border-slate-300 w-[15%]">Invigilator</th>
                                    <th className="py-3 px-2 text-right text-sm md:text-base font-bold border-b-2 border-slate-800 border-r border-slate-300 w-[15%]">Lemma <span className="block text-xs font-normal text-slate-600">(Book Value)</span></th>
                                    <th className="py-3 px-2 text-right text-sm md:text-base font-bold border-b-2 border-slate-800 border-r border-slate-300 w-[15%]">Lemma <span className="block text-xs font-normal text-slate-600">(Fair Value)</span></th>
                                    <th className="py-3 pr-4 pl-2 text-right text-sm md:text-base font-extrabold text-teal-900 bg-teal-50 border-b-2 border-teal-600 w-[20%]">Consolidated <span className="block text-[10px] font-normal text-teal-600">(Click cell)</span></th>
                                </tr>
                            </thead>
                            <tbody className="text-sm md:text-base">
                                {data.map((row, index) => {
                                    if (row.type === 'section') return <tr key={index} className="bg-white"><td colSpan="5" className="pt-3 pb-1 pl-4 text-xs md:text-sm font-black text-slate-400 uppercase tracking-widest border-b border-gray-200">{row.label}</td></tr>;
                                    if (row.type === 'spacer') return <tr key={index}><td colSpan="5" className="h-2 bg-white"></td></tr>;
                                    if (row.type === 'row') {
                                        const isInteractive = !!row.explanation;
                                        return (
                                            <tr key={index} className="even:bg-slate-50 odd:bg-white border-b border-gray-200 group">
                                                <td className="py-1 pl-4 pr-2 text-slate-800 font-medium border-r border-gray-200">{row.label}</td>
                                                <td className="py-1 px-2 text-right text-slate-600 font-mono border-r border-gray-200">{row.c1}</td>
                                                <td className="py-1 px-2 text-right text-slate-600 font-mono border-r border-gray-200">{row.c2}</td>
                                                <td className="py-1 px-2 text-right text-slate-600 font-mono border-r border-gray-200">{row.c3}</td>
                                                <td onClick={() => handleCellClick(row)} className={`py-1 pr-4 pl-2 text-right font-mono font-bold border-l border-teal-100 relative ${isInteractive ? 'cursor-pointer hover:bg-teal-100 bg-teal-50/30 text-teal-900' : 'text-slate-900'}`}>
                                                    {row.c4}
                                                    {isInteractive && <span className="absolute right-0 top-0 mt-1 mr-1 w-2 h-2 bg-teal-500 rounded-full opacity-0 group-hover:opacity-100"></span>}
                                                </td>
                                            </tr>
                                        );
                                    }
                                    if (row.type === 'total') return <tr key={index} className="bg-slate-200 border-t-2 border-slate-300"><td className="py-1 pl-4 pr-2 font-bold text-slate-900 border-r border-slate-300">{row.label}</td><td className="py-1 px-2 text-right font-bold text-slate-900 font-mono border-r border-slate-300">{row.c1}</td><td className="py-1 px-2 text-right font-bold text-slate-900 font-mono border-r border-slate-300">{row.c2}</td><td className="py-1 px-2 text-right font-bold text-slate-900 font-mono border-r border-slate-300">{row.c3}</td><td className="py-1 pr-4 pl-2 text-right font-black text-teal-900 font-mono bg-teal-100">{row.c4}</td></tr>;
                                    if (row.type === 'grand_total') return <tr key={index} className="bg-slate-900 text-white border-t-4 border-slate-800"><td className="py-2 pl-4 pr-2 font-bold uppercase tracking-wider text-base md:text-lg">{row.label}</td><td className="py-2 px-2 text-right font-bold font-mono text-gray-300 text-lg md:text-xl">{row.c1}</td><td className="py-2 px-2 text-right font-bold font-mono text-gray-300 text-lg md:text-xl">{row.c2}</td><td className="py-2 px-2 text-right font-bold font-mono text-gray-300 text-lg md:text-xl">{row.c3}</td><td className="py-2 pr-4 pl-2 text-right font-black font-mono text-teal-300 text-xl md:text-2xl bg-slate-800">{row.c4}</td></tr>;
                                    return null;
                                })}
                            </tbody>
                        </table>
                    </div>

                    {/* Modal Popup */}
                    {selectedCell && (
                    <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in" onClick={() => setSelectedCell(null)}>
                        <div className="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden" onClick={(e) => e.stopPropagation()}>
                            <div className="bg-teal-600 p-4 flex justify-between items-center text-white">
                                <h3 className="font-bold flex items-center gap-2"><InfoIcon size={20} /> {selectedCell.explanation.title}</h3>
                                <button onClick={() => setSelectedCell(null)}><XIcon size={24} /></button>
                            </div>
                            <div className="p-6">
                                {/* Theoretical Explanation */}
                                {selectedCell.explanation.theory && (
                                    <div className="mb-4 bg-blue-50 p-3 rounded text-sm text-slate-700 border border-blue-100">
                                        <p className="font-bold text-blue-900 mb-1">Concept:</p>
                                        {selectedCell.explanation.theory}
                                    </div>
                                )}

                                {selectedCell.explanation.isRichContent ? (
                                    <div className="space-y-3">
                                        {selectedCell.explanation.steps.map((step, i) => (
                                            <React.Fragment key={i}>
                                                {step.operator && (
                                                    <div className="flex justify-center items-center py-1">
                                                        <span className="text-2xl font-bold text-slate-300">{step.operator}</span>
                                                    </div>
                                                )}
                                                <div className={`p-3 rounded shadow-sm flex justify-between items-center
                                                    ${step.isResult ? 'bg-slate-900 text-white' : 'bg-white border-l-4'}
                                                    ${!step.isResult && step.color === 'blue' ? 'border-blue-500' : ''}
                                                    ${!step.isResult && step.color === 'green' ? 'border-green-500' : ''}
                                                    ${!step.isResult && step.color === 'teal' ? 'border-teal-500' : ''}
                                                    ${!step.isResult && step.color === 'slate' ? 'border-slate-500' : ''}
                                                `}>
                                                    <div>
                                                        <p className={`text-xs uppercase font-bold ${step.isResult ? 'text-teal-400' : 'text-slate-500'}`}>{step.label}</p>
                                                        <p className={`text-xs ${step.isResult ? 'text-slate-400' : 'text-slate-400'}`}>{step.desc}</p>
                                                    </div>
                                                    <div className={`text-xl font-mono font-bold ${step.isResult ? 'text-teal-400' : 'text-slate-800'}`}>
                                                        {step.value}
                                                    </div>
                                                </div>
                                            </React.Fragment>
                                        ))}
                                    </div>
                                ) : (
                                    <>
                                        <div className="bg-gray-100 p-3 rounded mb-4 font-mono text-teal-800 font-bold border border-gray-200 text-center">{selectedCell.explanation.math}</div>
                                        <p className="text-gray-700">{selectedCell.explanation.details}</p>
                                    </>
                                )}
                            </div>
                        </div>
                    </div>
                    )}
                </div>
            </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FinancialStatementInteractive />);
    </script>
</body>
</html>