<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invigilator Case - Consolidated Financial Statement</title>
    <style>
        /* --- GENERAL STYLES (Standalone - No External Libs) --- */
        :root {
            --primary: #0f172a; /* Slate 900 */
            --accent: #0d9488; /* Teal 600 */
            --accent-light: #ccfbf1; /* Teal 100 */
            --bg-body: #cbd5e1; /* Darker gray for background frame */
            --text-dark: #1e293b;
            --text-light: #475569;
            --white: #ffffff;
            --border: #cbd5e1; /* Darker border for grid lines */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            margin: 0;
            padding: 40px 10px;
            color: var(--text-dark);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align top with some margin */
            box-sizing: border-box;
        }

        /* Main Card Container (The "Paper") */
        .main-container {
            background: var(--white);
            width: 100%;
            max-width: 720px; /* Slightly wider to accommodate larger font comfortably */
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            border-radius: 4px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 1px solid #94a3b8;
        }

        /* Header */
        .header {
            background-color: var(--primary);
            color: white;
            padding: 12px 20px;
            border-bottom: 4px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 { margin: 0; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
        .header p { margin: 2px 0 0; color: #2dd4bf; font-size: 0.75rem; font-weight: 600; }

        .btn-menu {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            transition: background 0.2s;
        }
        .btn-menu:hover { background-color: #0f766e; }

        /* Table Styling */
        .table-container { 
            overflow-x: auto; 
            padding-bottom: 5px;
        }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            table-layout: fixed; 
            font-size: 0.9rem; /* INCREASED BASE FONT SIZE */
        }
        
        /* ADJUSTED COLUMN WIDTHS */
        th:nth-child(1) { width: 34%; } /* Account Name */
        th:nth-child(2) { width: 16.5%; } 
        th:nth-child(3) { width: 16.5%; } 
        th:nth-child(4) { width: 16.5%; } 
        th:nth-child(5) { width: 16.5%; } 

        th {
            background-color: #e2e8f0;
            color: var(--text-dark);
            text-align: center; /* CENTERED TITLES */
            padding: 10px 4px;
            font-size: 0.75rem; /* INCREASED FONT SIZE */
            text-transform: uppercase;
            border: 1px solid var(--border);
            vertical-align: bottom;
            font-weight: 800;
            line-height: 1.2;
        }
        th:first-child { text-align: left; padding-left: 12px; }
        th.consolidado-header { background-color: var(--accent-light); color: #115e59; border-bottom: 2px solid var(--accent); }

        td {
            padding: 5px 6px;
            text-align: right;
            border: 1px solid var(--border);
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.95rem; /* INCREASED NUMBER FONT SIZE */
            color: #334155;
            white-space: nowrap;
        }
        td:first-child { 
            text-align: left; 
            padding-left: 12px;
            font-family: inherit; 
            font-weight: 600; /* Bolder text for items */
            color: var(--text-dark);
            white-space: normal;
            font-size: 0.85rem; /* INCREASED TEXT FONT SIZE */
            line-height: 1.2;
        }

        /* ZEBRA STRIPING & HOVER */
        tr:nth-child(even) { background-color: #f1f5f9; }
        tr:hover { background-color: #fffbeb; }

        .row-section td {
            background-color: #ffffff;
            font-size: 0.75rem; /* Increased */
            font-weight: 900;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding-top: 15px;
            padding-bottom: 6px;
            border-bottom: 2px solid #cbd5e1;
            text-align: left;
            padding-left: 12px;
        }

        .row-total td {
            background-color: #e2e8f0;
            font-weight: 800;
            color: var(--text-dark);
            border-top: 2px solid #94a3b8;
            padding-top: 8px;
            padding-bottom: 8px;
            font-size: 0.95rem; /* Increased */
        }

        .row-grand-total td {
            background-color: var(--primary);
            color: #cbd5e1;
            font-weight: 800;
            font-size: 1rem; /* Increased */
            padding: 12px 6px;
            border: 1px solid #334155;
        }
        .row-grand-total td:last-child { color: #2dd4bf; font-size: 1.1rem; border-left: 1px solid #475569; }

        /* Interactive Cells */
        td.interactive {
            background-color: rgba(13, 148, 136, 0.08);
            color: #0d9488;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(13, 148, 136, 0.3);
        }
        td.interactive:hover {
            background-color: var(--accent-light);
            text-decoration: underline;
            color: #0f766e;
        }
        
        td.interactive-lemma {
            background-color: rgba(59, 130, 246, 0.08);
            color: #2563eb;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.3);
        }
        td.interactive-lemma:hover {
            background-color: #dbeafe;
            text-decoration: underline;
            color: #1e40af;
        }

        /* --- SIDEBAR --- */
        .overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 40;
            display: none;
            backdrop-filter: blur(2px);
        }
        .overlay.active { display: block; }

        .sidebar {
            position: fixed; top: 0; left: 0; height: 100%;
            width: 700px;
            max-width: 90%;
            background: white;
            z-index: 50;
            transform: translateX(-100%);
            transition: transform 0.3s ease-in-out;
            box-shadow: 5px 0 25px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
        }
        .sidebar.active { transform: translateX(0); }

        .sidebar-header {
            padding: 15px 20px;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        .sidebar-header h3 { margin: 0; font-size: 1.1rem; }

        .nav-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            padding: 5px;
            background: #f1f5f9;
            border-bottom: 1px solid #cbd5e1;
            flex-shrink: 0;
        }

        .nav-item {
            background: white;
            border: 1px solid #cbd5e1;
            padding: 5px 2px;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 50px;
        }
        .nav-item:hover { background: #e2e8f0; }
        .nav-item.active {
            background: white;
            border-color: var(--accent);
            color: var(--accent);
            box-shadow: inset 0 0 0 2px var(--accent);
        }
        .nav-num { display: block; font-size: 1rem; font-weight: 900; opacity: 0.3; line-height: 1; }
        .nav-label { font-size: 0.65rem; font-weight: bold; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f8fafc;
        }

        .cards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .card {
            background: white; padding: 12px; border-radius: 6px;
            border: 1px solid #e2e8f0; margin-bottom: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .card.full-width { grid-column: span 2; }
        .card-header { font-weight: bold; color: var(--text-dark); margin-bottom: 4px; font-size: 0.85rem; }
        .card-body { font-size: 0.8rem; color: var(--text-light); line-height: 1.4; }
        
        .badge {
            display: inline-block; padding: 1px 6px; border-radius: 10px;
            font-size: 0.7rem; font-weight: bold; margin-left: 5px; float: right;
        }
        .bg-green { background: #dcfce7; color: #166534; }
        .bg-red { background: #fee2e2; color: #991b1b; }
        .bg-blue { background: #dbeafe; color: #1e40af; }

        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: slideIn 0.2s; }
        .tab-title { color: var(--accent); margin-top: 0; margin-bottom: 10px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .theory-box { background: #eff6ff; padding: 10px; border-radius: 6px; border: 1px solid #bfdbfe; font-size: 0.85rem; color: #1e3a8a; margin-bottom: 15px; line-height: 1.4; }
        .calc-row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #eee; font-size: 0.85rem; }
        .calc-row span:last-child { font-family: monospace; font-weight: bold; font-size: 0.95rem; }
        .calc-total { background: var(--primary); color: white; padding: 8px; border-radius: 4px; margin-top: 10px; font-weight: bold; display: flex; justify-content: space-between; font-size: 0.85rem; }

        /* Modal */
        .modal-wrapper {
            position: fixed; inset: 0; z-index: 100;
            display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(2px);
            opacity: 0; pointer-events: none;
            transition: opacity 0.2s;
        }
        .modal-wrapper.open { opacity: 1; pointer-events: auto; }
        .modal-box { background: white; width: 90%; max-width: 380px; border-radius: 8px; overflow: hidden; box-shadow: 0 20px 25px rgba(0,0,0,0.2); transform: scale(0.95); transition: transform 0.2s; }
        .modal-wrapper.open .modal-box { transform: scale(1); }
        .modal-head { background: var(--accent); padding: 10px 15px; color: white; display: flex; justify-content: space-between; font-weight: bold; font-size: 0.95rem; }
        .modal-body { padding: 15px; }
        .close-btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.1rem; }

    </style>
</head>
<body>

    <div class="main-container">
        <!-- HEADER -->
        <div class="header">
            <div>
                <h1>Invigilator Case</h1>
                <p>Interactive Consolidated Statement</p>
            </div>
            <button class="btn-menu" onclick="toggleSidebar()">
                <span style="font-size:1rem">ðŸ“š</span> Menu
            </button>
        </div>

        <!-- TABLE -->
        <div class="table-container">
            <table id="financialTable">
                <thead>
                    <tr>
                        <th>Account / Item</th>
                        <th>Invigilator</th>
                        <th>Lemma <br><span style="font-weight:400; font-size:0.7em">(Book)</span></th>
                        <th class="consolidado-header" style="background-color:rgba(59, 130, 246, 0.1); border-bottom-color:#3b82f6; color:#1e40af">Lemma <br><span style="font-weight:400; font-size:0.7em">(FV - Click!)</span></th>
                        <th class="consolidado-header">Consolidated<br><span style="font-weight:400; font-size:0.7em; color: inherit;">(Details)</span></th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Rows injected via JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3>Step-by-Step Guide</h3>
            <button class="close-btn" onclick="toggleSidebar()">âœ•</button>
        </div>
        
        <div class="nav-grid">
            <div class="nav-item active" onclick="showTab('step0', this)"><span class="nav-label">OVERVIEW</span></div>
            <div class="nav-item" onclick="showTab('step1', this)"><span class="nav-num">1</span><span class="nav-label">Fair Val</span></div>
            <div class="nav-item" onclick="showTab('step2', this)"><span class="nav-num">2</span><span class="nav-label">Aggr.</span></div>
            <div class="nav-item" onclick="showTab('step3', this)"><span class="nav-num">3</span><span class="nav-label">Elim.</span></div>
            <div class="nav-item" onclick="showTab('step4', this)"><span class="nav-num">4</span><span class="nav-label">Goodwill</span></div>
            <div class="nav-item" onclick="showTab('step5', this)"><span class="nav-num">5</span><span class="nav-label">NCI</span></div>
            <div class="nav-item" onclick="showTab('step6', this)"><span class="nav-num">6</span><span class="nav-label">Intra</span></div>
        </div>

        <div class="sidebar-content">
            <!-- STEP 0: OVERVIEW -->
            <div id="step0" class="tab-pane active">
                <h2 class="tab-title">Consolidation Logic Overview</h2>
                <div class="cards-grid">
                    <div class="card" onclick="showTab('step1', document.querySelectorAll('.nav-item')[1])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">1. Fair Value Adjustments</div>
                        <div class="card-body">Adjust subsidiary assets to market value.</div>
                    </div>
                    <div class="card" onclick="showTab('step2', document.querySelectorAll('.nav-item')[2])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">2. Aggregation</div>
                        <div class="card-body">Sum line by line (100% Parent + 100% Subsidiary).</div>
                    </div>
                    <div class="card" onclick="showTab('step3', document.querySelectorAll('.nav-item')[3])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">3. Eliminate Investment</div>
                        <div class="card-body">Remove "Investment" vs. Subsidiary Equity.</div>
                    </div>
                    <div class="card" onclick="showTab('step4', document.querySelectorAll('.nav-item')[4])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">4. Recognize Goodwill</div>
                        <div class="card-body">Calculate premium paid over net assets.</div>
                    </div>
                    <div class="card" onclick="showTab('step5', document.querySelectorAll('.nav-item')[5])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">5. Calculate NCI</div>
                        <div class="card-body">Recognize 10% minority interest claim.</div>
                    </div>
                    <div class="card" onclick="showTab('step6', document.querySelectorAll('.nav-item')[6])" style="cursor:pointer; border-left: 3px solid var(--accent)">
                        <div class="card-header">6. Eliminate Intra-group</div>
                        <div class="card-body">Cancel internal debts/sales.</div>
                    </div>
                </div>
            </div>

            <!-- STEP 1: FAIR VALUE -->
            <div id="step1" class="tab-pane">
                <h2 class="tab-title">1. Fair Value Adjustments</h2>
                <div class="theory-box">Adjust Subsidiary's book values to Fair Values (FV) at acquisition date.</div>
                
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">Patents <span class="badge bg-green">+80k</span></div>
                        <div class="card-body">Book: 2k â†’ FV: 82k</div>
                    </div>
                    <div class="card">
                        <div class="card-header">PPE <span class="badge bg-green">+80k</span></div>
                        <div class="card-body">Book: 80k â†’ FV: 160k</div>
                    </div>
                    <div class="card">
                        <div class="card-header">Inventory <span class="badge bg-red">-40k</span></div>
                        <div class="card-body">Book: 360k â†’ FV: 320k</div>
                    </div>
                    <div class="card" style="background:#eff6ff; border:1px solid #bfdbfe; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <div style="font-size:0.7rem; color:#1e40af; text-transform:uppercase; font-weight:bold;">Net Impact</div>
                        <div style="font-size:1.4rem; font-weight:bold; color:#1d4ed8">+120,000</div>
                    </div>
                </div>
            </div>

            <!-- STEP 2: AGGREGATION -->
            <div id="step2" class="tab-pane">
                <h2 class="tab-title">2. Aggregation</h2>
                <div class="theory-box">Sum financial statements line by line (100% Parent + 100% Subsidiary).</div>
                <div class="card full-width">
                    <div class="card-header">Example: Current Liabilities</div>
                    <div class="calc-row"><span>Invigilator</span> <span>560,000</span></div>
                    <div class="calc-row"><span>+ Lemma</span> <span>352,000</span></div>
                    <div class="calc-total" style="background:#f1f5f9; color:#333; border:1px solid #ccc"><span>= Combined</span> <span>912,000</span></div>
                    <div style="font-size:0.75rem; color:#999; margin-top:5px; text-align:right;">(Before eliminations)</div>
                </div>
            </div>

            <!-- STEP 3: ELIMINATION -->
            <div id="step3" class="tab-pane">
                <h2 class="tab-title">3. Investment Elimination</h2>
                <div class="theory-box" style="background:#fff1f2; border-color:#fecdd3; color:#881337">
                    <strong>Rule:</strong> Remove Investment (Asset) and Subsidiary's Equity to avoid double counting.
                </div>
                <div class="cards-grid">
                    <div class="card" style="border-left:4px solid #dc2626">
                        <div class="card-header" style="color:#dc2626">Credit (Asset)</div>
                        <div class="calc-row"><span>Inv. in Lemma</span> <span>-600,000</span></div>
                    </div>
                    <div class="card" style="border-left:4px solid #dc2626">
                        <div class="card-header" style="color:#dc2626">Debit (Equity)</div>
                        <div class="calc-row"><span>Share Capital</span> <span>-200,000</span></div>
                        <div class="calc-row"><span>Reserves</span> <span>-100,000</span></div>
                    </div>
                </div>
            </div>

            <!-- STEP 4: GOODWILL -->
            <div id="step4" class="tab-pane">
                <h2 class="tab-title">4. Goodwill Calculation</h2>
                <div class="theory-box">Premium paid over the Fair Market Value of net assets.</div>
                
                <div class="card full-width">
                    <div class="calc-row"><span>A. Price Paid (Investment)</span> <strong>600,000</strong></div>
                    <div class="calc-row"><span>B. Acquired Value (90% of Net Assets)</span> <strong style="color:#dc2626">-378,000</strong></div>
                    <div class="calc-total">
                        <span>GOODWILL</span> <span>222,000</span>
                    </div>
                    <div style="font-size:0.75rem; margin-top:8px; color:#666; text-align:center">
                        *Acquired Value = (300k Book Equity + 120k FV Adj) Ã— 90%
                    </div>
                </div>
            </div>

            <!-- STEP 5: NCI -->
            <div id="step5" class="tab-pane">
                <h2 class="tab-title">5. NCI Calculation</h2>
                <div class="theory-box" style="background:#faf5ff; border-color:#e9d5ff; color:#6b21a8">
                    <strong>NCI:</strong> 10% minority equity claim on the <strong>Fair Value</strong> of Net Assets.
                </div>
                
                <div class="card full-width" style="border-top: 4px solid #a855f7">
                    <div class="calc-row"><span>Lemma Capital</span> <span>200,000</span></div>
                    <div class="calc-row"><span>Lemma Reserves</span> <span>100,000</span></div>
                    <div class="calc-row"><span>FV Adjustments</span> <span style="color:var(--accent)">+120,000</span></div>
                    <div class="calc-row" style="background:#f8fafc; font-weight:bold; border-top:2px solid #ddd"><span>Total Net Assets (FV)</span> <span>420,000</span></div>
                    
                    <div style="text-align:center; padding:10px; font-weight:bold; color:#6b21a8; font-size:0.9rem">Ã— 10% Minority Stake</div>
                    
                    <div class="calc-total" style="background:#6b21a8">
                        <span>NCI Value</span> <span>42,000</span>
                    </div>
                </div>
            </div>

            <!-- STEP 6: INTRA-GROUP -->
            <div id="step6" class="tab-pane">
                <h2 class="tab-title">6. Intra-group</h2>
                <div class="theory-box" style="background:#fefce8; border-color:#fef08a; color:#854d0e">
                    Cancel internal debts. Entity cannot owe money to itself.
                </div>
                <div class="card full-width">
                    <div style="text-align:center; margin-bottom:10px; font-size:0.9rem">Invigilator owes Lemma <strong>100,000</strong></div>
                    <div class="cards-grid">
                        <div style="background:#fee2e2; padding:10px; border-radius:4px; text-align:center; color:#991b1b">
                            <div style="font-size:0.7rem; font-weight:bold; text-transform:uppercase">Assets</div>
                            <div style="font-size:0.8rem">Receivables</div>
                            <div style="font-weight:bold">-100,000</div>
                        </div>
                        <div style="background:#fee2e2; padding:10px; border-radius:4px; text-align:center; color:#991b1b">
                            <div style="font-size:0.7rem; font-weight:bold; text-transform:uppercase">Liabilities</div>
                            <div style="font-size:0.8rem">Payables</div>
                            <div style="font-weight:bold">-100,000</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        
        <div style="padding:10px; border-top:1px solid #eee; text-align:center; background:white;">
            <button onclick="toggleSidebar()" style="background:#1e293b; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; width:100%; font-weight:bold;">Back to Table</button>
        </div>
    </div>

    <!-- MODAL (POPUP) -->
    <div class="modal-wrapper" id="modalWrapper" onclick="closeModal()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <div class="modal-head">
                <span id="modalTitle">Title</span>
                <button class="close-btn" onclick="closeModal()">âœ•</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Content -->
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const tableRows = [
            { type: 'section', label: 'ASSETS' },
            { 
                type: 'row', label: 'Intangible assets', c1: '-', c2: '2,000', c3: '82,000', c4: '82,000', 
                info: { title: 'Intangible Assets', theory: 'Under IFRS 3, recognize acquiree assets at Fair Value even if not in books.', math: '0 + 82,000 = 82,000', text: 'Recognized Patent (FV 80k) + Book (2k).' },
                lemmaFvInfo: { title: 'FV Adjustment: Intangibles', theory: 'Recognition of internally generated patent.', math: '82,000 (FV) - 2,000 (Book) = +80,000 Adjustment', text: 'Assets must be recognized at fair value.'}
            },
            { type: 'row', label: 'Goodwill', c1: '-', c2: '-', c3: '-', c4: '222,000', info: { title: 'Goodwill', theory: 'Premium paid over the Fair Market Value of net assets.', steps: [['Price Paid', '600,000'], ['- Acquired Value', '378,000'], ['= Goodwill', '222,000']] } },
            { 
                type: 'row', label: 'Property, plant & equipment', c1: '490,000', c2: '80,000', c3: '160,000', c4: '650,000', 
                info: { title: 'PPE', math: '490,000 + 160,000 = 650,000', text: 'Using Lemma\'s Fair Value (160k).' },
                lemmaFvInfo: { title: 'FV Adjustment: PPE', theory: 'Revaluation of property to market rates.', math: '160,000 (FV) - 80,000 (Book) = +80,000 Adjustment', text: 'Increase in value of corporate offices.'}
            },
            { type: 'row', label: 'Investment in Lemma', c1: '600,000', c2: '-', c3: '-', c4: '-', info: { title: 'Investment Elimination', theory: 'Investment eliminated against Subsidiary Equity.', math: '600,000 - 600,000 = 0', text: 'Asset removed.' } },
            { 
                type: 'row', label: 'Inventories', c1: '230,000', c2: '360,000', c3: '320,000', c4: '550,000', 
                info: { title: 'Inventories', math: '230,000 + 320,000 = 550,000', text: 'Inventory adjusted down to Fair Value (-40k).' },
                lemmaFvInfo: { title: 'FV Adjustment: Inventories', theory: 'Write-down to net realizable value or fair value.', math: '320,000 (FV) - 360,000 (Book) = -40,000 Adjustment', text: 'Decrease due to obsolescence or market conditions.'}
            },
            { type: 'row', label: 'Trade and other receivables', c1: '400,000', c2: '240,000', c3: '240,000', c4: '540,000', info: { title: 'Receivables', math: '(400k + 240k) - 100k', text: 'Internal debt eliminated.' } },
            { type: 'grand', label: 'TOTAL ASSETS', c1: '1,720,000', c2: '682,000', c3: '802,000', c4: '2,044,000' },
            
            // Removed empty spacer row here per user request
            { type: 'section', label: 'EQUITY' },
            { type: 'row', label: 'Share capital', c1: '1,000,000', c2: '200,000', c3: '-', c4: '1,000,000', info: {title: 'Share Capital', theory: 'Only Parent capital shown.', math:'Parent Only', text: 'Lemma capital eliminated.'} },
            { type: 'row', label: 'Reserves', c1: '140,000', c2: '100,000', c3: '-', c4: '140,000', info: {title: 'Reserves', theory: 'Only Parent reserves shown.', math:'Parent Only', text: 'Pre-acquisition reserves eliminated.'} },
            { type: 'row', label: 'Non-controlling interest', c1: '-', c2: '-', c3: '-', c4: '42,000', info: { title: 'NCI', theory: '10% minority stake on Fair Value Net Assets.', steps: [['Net Assets (FV)', '420,000'], ['Ã— 10% Minority', '10%'], ['= NCI', '42,000']] } },
            { type: 'total', label: 'TOTAL EQUITY', c1: '1,140,000', c2: '300,000', c3: '420,000', c4: '1,182,000' },
            
            { type: 'space' },
            { type: 'section', label: 'LIABILITIES' },
            { type: 'row', label: 'Provisions', c1: '20,000', c2: '30,000', c3: '30,000', c4: '50,000' },
            { type: 'row', label: 'Current liabilities', c1: '560,000', c2: '352,000', c3: '352,000', c4: '812,000', info: { title: 'Liabilities', math: '(560k + 352k) - 100k', text: 'Intra-group debt elimination.' } },
            { type: 'total', label: 'TOTAL LIABILITIES', c1: '580,000', c2: '382,000', c3: '382,000', c4: '862,000' },
            
            // Removed empty spacer row here per user request
            { type: 'grand', label: 'TOTAL EQUITY & LIABILITIES', c1: '1,720,000', c2: '682,000', c3: '802,000', c4: '2,044,000' },
        ];

        // RENDER TABLE
        const tbody = document.getElementById('table-body');
        let html = '';

        tableRows.forEach((r, i) => {
            if(r.type === 'section') {
                html += `<tr class="row-section"><td colspan="5">${r.label}</td></tr>`;
            } else if (r.type === 'space') {
                html += `<tr><td colspan="5" style="height:10px"></td></tr>`;
            } else if (r.type === 'total') {
                html += `<tr class="row-total"><td>${r.label}</td><td>${r.c1}</td><td>${r.c2}</td><td>${r.c3}</td><td>${r.c4}</td></tr>`;
            } else if (r.type === 'grand') {
                html += `<tr class="row-grand-total"><td>${r.label}</td><td>${r.c1}</td><td>${r.c2}</td><td>${r.c3}</td><td>${r.c4}</td></tr>`;
            } else {
                const clickable = r.info ? 'interactive' : '';
                const clickAttr = r.info ? `onclick="openModal(${i}, 'consolidated')"` : '';
                
                // Add interaction for Lemma FV Column (index 3, i.e., r.c3)
                const clickableLemma = r.lemmaFvInfo ? 'interactive-lemma' : '';
                const clickAttrLemma = r.lemmaFvInfo ? `onclick="openModal(${i}, 'lemma')"` : '';

                html += `<tr>
                    <td>${r.label}</td>
                    <td>${r.c1}</td>
                    <td>${r.c2}</td>
                    <td class="${clickableLemma}" ${clickAttrLemma}>${r.c3}${r.lemmaFvInfo ? '<span class="badge bg-blue" style="float:right; transform:scale(0.7)">â„¹</span>' : ''}</td>
                    <td class="${clickable}" ${clickAttr}>${r.c4}</td>
                </tr>`;
            }
        });
        tbody.innerHTML = html;

        // FUNCTIONS
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        function showTab(id, btn) {
            document.querySelectorAll('.tab-pane').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(btn) btn.classList.add('active');
        }

        function openModal(index, type) {
            const row = tableRows[index];
            const info = type === 'lemma' ? row.lemmaFvInfo : row.info;
            
            if(!info) return;
            document.getElementById('modalTitle').innerText = info.title;
            const body = document.getElementById('modalBody');
            
            let content = '';
            if(info.theory) content += `<div class="theory-box"><strong>Concept:</strong> ${info.theory}</div>`;
            
            if(info.steps) {
                info.steps.forEach(s => {
                    content += `<div class="calc-row" ${s.length===3?'style="background:var(--primary); color:white; font-weight:bold; padding:8px; border-radius:4px"':''}><span>${s[0]}</span><span>${s[1]}</span></div>`;
                });
            } else {
                if(info.math) content += `<div style="background:#f1f5f9; padding:10px; font-family:monospace; font-weight:bold; text-align:center; margin-bottom:10px">${info.math}</div>`;
                if(info.text) content += `<p style="color:#475569; font-size:0.9rem">${info.text}</p>`;
            }
            body.innerHTML = content;
            document.getElementById('modalWrapper').classList.add('open');
        }

        function closeModal() {
            document.getElementById('modalWrapper').classList.remove('open');
        }
    </script>
</body>
</html>